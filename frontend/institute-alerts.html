<!DOCTYPE html>
<html lang="en" class="light-style layout-menu-fixed" dir="ltr" data-theme="theme-default" data-assets-path="../assets/" data-template="vertical-menu-template-free">
<head>
  <meta charset="utf-8" />
  <title>institute Alerts | Fake Degree Recognition System</title>
  <link rel="stylesheet" href="../assets/vendor/css/core.css" />
  <link rel="stylesheet" href="../assets/vendor/css/theme-default.css" />
  <link rel="stylesheet" href="../assets/css/demo.css" />
  <link rel="stylesheet" href="../assets/vendor/fonts/boxicons.css" />
  <script src="../assets/vendor/js/helpers.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@700&family=Playfair+Display:wght@700&family=Yeseva+One&display=swap" rel="stylesheet">
  <style>
    .logo-text { font-family: 'UnifrakturCook', 'Playfair Display', 'Yeseva One', serif; font-weight:700; letter-spacing:1px; text-transform:none; font-size:28px; color:#0f172a; line-height:1; white-space:nowrap; }
  </style>
  <script src="../assets/js/config.js"></script>
</head>
<body>
  <div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
      <!-- Sidebar -->
      <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
        <div class="app-brand demo">
          <a href="institute-dashboard.html" class="app-brand-link">
            <span class="logo-text">Sachpatr</span>
          </a>
          <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto d-block d-xl-none">
            <i class="bx bx-chevron-left bx-sm align-middle"></i>
          </a>
        </div>
        <div class="menu-inner-shadow"></div>
        <ul class="menu-inner py-1">
          <li class="menu-item">
            <a href="institute-dashboard.html" class="menu-link">
              <i class="menu-icon tf-icons bx bx-home-circle"></i>
              <div>Dashboard</div>
            </a>
          </li>
          <li class="menu-item">
            <a href="upload-certificates.html" class="menu-link">
              <i class="menu-icon tf-icons bx bx-upload"></i>
              <div>Upload Certificates</div>
            </a>
          </li>
          <li class="menu-item active">
            <a href="institute-alerts.html" class="menu-link">
              <i class="menu-icon tf-icons bx bx-bell"></i>
              <div>Alerts</div>
            </a>
          </li>
        </ul>
      </aside>

      <!-- Page Content -->
      <div class="layout-page">
        <nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme" id="layout-navbar">
          <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
            <ul class="navbar-nav flex-row align-items-center ms-auto">
              <li class="nav-item navbar-dropdown dropdown-user dropdown">
                <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown">
                  <div class="avatar avatar-online">
                    <img src="../assets/img/avatars/1.png" alt class="w-px-40 h-auto rounded-circle"/>
                  </div>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li><a class="dropdown-item" href="institute-profile.html"><i class="bx bx-user me-2"></i> My Profile</a></li>
                  <li><a class="dropdown-item" href="auth-login-basic.html"><i class="bx bx-power-off me-2"></i> Log Out</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </nav>

        <div class="content-wrapper container-xxl flex-grow-1 container-p-y">
          <h2 class="py-2">Alerts for Your Institution</h2>

          <div class="card mb-4 p-3 overflow-auto">
            <h5>Notification Settings</h5>
            <div class="form-check form-switch mb-2">
              <input class="form-check-input" type="checkbox" id="email-notifications" checked>
              <label class="form-check-label" for="email-notifications">Enable Email Notifications</label>
            </div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="sms-notifications">
              <label class="form-check-label" for="sms-notifications">Enable SMS Notifications</label>
            </div>
          </div>

          <div class="card mb-4 p-3 overflow-auto">
            <h5>Recent Alerts</h5>
            <div class="table-responsive">
              <table class="table table-striped table-bordered mb-0">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Alert Type</th>
                    <th>Description</th>
                    <th>Date & Time</th>
                  </tr>
                </thead>
                <tbody id="alerts-table-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function getLocalUploads() {
      try { const raw = localStorage.getItem('userCertificates'); return raw ? JSON.parse(raw) : []; } catch(_) { return []; }
    }

    function toAlerts(list) {
      const alerts = [];
      list.slice(0, 50).forEach(item => {
        const combined = item.scores?.combined ?? 0;
        const dt = item.uploadDate ? new Date(item.uploadDate).toLocaleString() : '-';
        if (combined < 60) alerts.push({ type: 'Forgery Alert', desc: `Low authenticity for ${item.certificateId || item.fileName}`, dt });
        else if (combined < 80) alerts.push({ type: 'Review Needed', desc: `Manual review suggested for ${item.certificateId || item.fileName}`, dt });
      });
      return alerts;
    }

    function renderAlerts() {
      const body = document.getElementById('alerts-table-body');
      if (!body) return;
      const alerts = toAlerts(getLocalUploads());
      body.innerHTML = alerts.map((a, i) => `<tr><td>${i+1}</td><td>${a.type}</td><td>${a.desc}</td><td>${a.dt}</td></tr>`).join('') || '<tr><td colspan="4" class="text-center text-muted">No alerts yet</td></tr>';
    }

    document.addEventListener('DOMContentLoaded', () => {
      renderAlerts();
      window.addEventListener('storage', (e) => { if (!e || e.key === null || e.key === 'userCertificates') renderAlerts(); });
      window.addEventListener('focus', renderAlerts);
      document.addEventListener('visibilitychange', () => { if (document.visibilityState === 'visible') renderAlerts(); });
      setInterval(renderAlerts, 2000);
    });
  </script>

  <script src="../assets/vendor/js/bootstrap.js"></script>
  <script src="../assets/vendor/js/menu.js"></script>
</body>
</html>
