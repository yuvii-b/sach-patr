<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>
  <title>User Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@700&family=Playfair+Display:wght@700&family=Yeseva+One&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.44.0/apexcharts.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Public Sans', sans-serif;
      background: #f5f5f9;
      color: #697a8d;
    }

    .layout-wrapper {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .sidebar.hidden {
      transform: translateX(-100%);
    }

    .app-brand {
      padding: 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .app-brand-link {
      text-decoration: none;
    }

    .app-brand img {
      height: 160px;
      width: auto;
    }
    .logo-text {
      font-family: 'UnifrakturCook', 'Playfair Display', 'Yeseva One', serif;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: none;
      font-size: 28px;
      color: #0f172a;
      line-height: 1;
      white-space: nowrap;
    }

    .menu-toggle {
      display: none;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #697a8d;
    }

    .menu-list {
      list-style: none;
      padding: 0 12px;
    }

    .menu-item {
      margin-bottom: 4px;
    }

    .menu-link {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      color: #697a8d;
      text-decoration: none;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .menu-link:hover {
      background: #f5f5f9;
    }

    .menu-item.active .menu-link {
      background: #696cff;
      color: #fff;
      box-shadow: 0 2px 4px rgba(105, 108, 255, 0.4);
    }

    .menu-icon {
      font-size: 20px;
      margin-right: 12px;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: 260px;
      transition: margin-left 0.3s ease;
    }

    .main-content.expanded {
      margin-left: 0;
    }

    /* Navbar */
    .navbar {
      background: #fff;
      padding: 16px 24px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 999;
      width: 100%;
    }

    .mobile-menu-btn {
      display: none;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #697a8d;
    }

    .search-box {
      display: flex;
      align-items: center;
      background: #f5f5f9;
      padding: 8px 16px;
      border-radius: 6px;
      flex: 1;
      max-width: 400px;
      margin: 0 16px;
    }

    .search-box i {
      font-size: 20px;
      margin-right: 8px;
      color: #a1acb8;
    }

    .search-box input {
      border: none;
      background: none;
      outline: none;
      width: 100%;
      font-size: 14px;
    }

    .user-dropdown {
      position: relative;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid #696cff;
    }

    /* Hero Section */
    .hero-section {
      min-height: 70vh;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
    }

    .hero-section h1 {
      font-size: clamp(24px, 5vw, 36px);
      color: #566a7f;
      margin-bottom: 32px;
      text-align: center;
    }

    .upload-cards {
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .cert-card {
      width: 200px;
      height: 260px;
      border: 2px dashed #d9dee3;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      background: #fff;
      overflow: hidden;
    }

    .cert-card:hover {
      border-color: #696cff;
      box-shadow: 0 4px 12px rgba(105, 108, 255, 0.2);
      transform: translateY(-4px);
    }

    .cert-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Loading */
    .loading-screen {
      min-height: 70vh;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    .loading-screen h3 {
      color: #566a7f;
      margin-top: 20px;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #696cff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Dashboard */
    .dashboard {
      padding: 24px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: #fff;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      text-align: center;
    }

    .stat-card .label {
      font-size: 14px;
      color: #697a8d;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .stat-card .value {
      font-size: 28px;
      font-weight: 700;
      margin: 0;
    }

    .value.success { color: #28c76f; }
    .value.warning { color: #ff9f43; }
    .value.info { color: #00cfe8; }

    .details-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 24px;
    }

    .detail-card {
      background: #fff;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    .detail-card h5 {
      font-size: 18px;
      color: #566a7f;
      margin-bottom: 16px;
      font-weight: 600;
    }

    .detail-card ul {
      list-style: none;
      padding: 0;
    }

    .detail-card li {
      padding: 8px 0;
      border-bottom: 1px solid #f5f5f9;
    }

    .detail-card li:last-child {
      border-bottom: none;
    }

    .heatmap-container {
      text-align: center;
    }

    .heatmap-container img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
    }

    /* Fullscreen Sample Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .modal-overlay.show { display: flex; }

    .modal-content {
      background: #fff;
      border-radius: 10px;
      max-width: 90vw;
      max-height: 90vh;
      display: grid;
      grid-template-rows: auto 1fr auto;
      width: 100%;
    }

    .modal-header, .modal-footer {
      padding: 12px 16px;
      border-bottom: 1px solid #f0f0f0;
    }

    .modal-header { display: flex; align-items: center; justify-content: space-between; }
    .modal-footer { border-bottom: none; border-top: 1px solid #f0f0f0; }

    .modal-body {
      padding: 10px;
      overflow: auto;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #111;
    }

    #sample-full {
      max-width: 100%;
      max-height: 80vh;
      filter: var(--img-filter, brightness(1) contrast(1));
    }

    .control-row { display: flex; gap: 16px; align-items: center; }
    .control-row label { width: 90px; color: #697a8d; }
    .control-row input[type="range"] { width: 220px; }

    .d-none {
      display: none !important;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.show {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .mobile-menu-btn {
        display: block;
      }

      .menu-toggle {
        display: block;
      }
    }

    @media (max-width: 768px) {
      .navbar {
        padding: 12px 16px;
        gap: 12px;
      }

      .search-box {
        max-width: none;
        flex: 1;
        margin: 0 8px;
      }

      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 12px;
      }

      .dashboard {
        padding: 16px;
      }

      .upload-cards {
        gap: 16px;
      }

      .cert-card {
        width: 150px;
        height: 195px;
      }
    }

    @media (max-width: 480px) {
      .search-box input {
        font-size: 13px;
      }

      .user-avatar {
        width: 36px;
        height: 36px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .details-grid {
        grid-template-columns: 1fr;
      }

      .hero-section {
        padding: 20px 12px;
      }
    }
  </style>
</head>
<body>
  <div class="layout-wrapper">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
       <div class="app-brand">
         <a href="user-index.html" class="app-brand-link">
           <span class="logo-text">Sachpatr</span>
         </a>
        <button class="menu-toggle" onclick="toggleSidebar()">
          <i class="bx bx-x"></i>
        </button>
      </div>
      <ul class="menu-list">
        <li class="menu-item active">
          <a href="index.html" class="menu-link">
            <i class="menu-icon bx bx-home-circle"></i>
            <span>Dashboard</span>
          </a>
        </li>
        <li class="menu-item">
          <a href="user-history.html" class="menu-link">
            <i class="menu-icon bx bx-layout"></i>
            <span>Your Uploads</span>
          </a>
        </li>
      </ul>
    </aside>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
      <!-- Navbar -->
      <nav class="navbar">
        <button class="mobile-menu-btn" onclick="toggleSidebar()">
          <i class="bx bx-menu"></i>
        </button>
        <div class="search-box">
          <i class="bx bx-search"></i>
          <input type="text" placeholder="Search..." />
        </div>
        <div class="user-dropdown">
          <img src="../assets/img/avatars/1.png" alt="User" class="user-avatar" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2240%22 height=%2240%22%3E%3Ccircle cx=%2220%22 cy=%2220%22 r=%2220%22 fill=%22%23696cff%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22white%22 font-size=%2218%22 font-family=%22sans-serif%22%3EJD%3C/text%3E%3C/svg%3E'">
        </div>
      </nav>

      <!-- Hero Section -->
      <section id="hero-section" class="hero-section">
        <h1>Your Uploaded Certificates</h1>
        <div class="upload-cards">
          <!-- Upload your own certificate -->
          <label class="cert-card" id="upload-card" title="Upload your certificate">
            <input id="file-input" type="file" accept="image/*,application/pdf" style="display:none" />
            <div style="display:flex;flex-direction:column;align-items:center;gap:8px;">
              <i class="bx bx-upload" style="font-size:28px;color:#a1acb8;"></i>
              <span>Upload Certificate</span>
            </div>
          </label>

          <!-- Sample certificate -->
          <div class="cert-card" id="sample-card" data-file="trial color mismatch.png" title="Double-click to preview fullscreen">
            <img id="sample-image" src="../assets/trial color mismatch.png" alt="Sample Certificate" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <span style="display: none;">Sample Certificate</span>
          </div>

          <!-- Text mismatch sample -->
          <div class="cert-card" id="name-mismatch-card" data-file="name mismatch.png" title="Text/Name Mismatch Sample">
            <span>Text Mismatch</span>
          </div>
        </div>
      </section>

      <!-- Loading Screen -->
      <div id="loading-screen" class="loading-screen d-none">
        <div class="spinner"></div>
        <h3>Verifying certificate...</h3>
      </div>

      <!-- Dashboard -->
      <div id="dashboard" class="dashboard d-none">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="label">Text Similarity</div>
            <h3 class="value success" id="cert-text">0%</h3>
          </div>
          <div class="stat-card">
            <div class="label">DB Field Match</div>
            <h3 class="value success" id="cert-meta">0%</h3>
          </div>
          <div class="stat-card">
            <div class="label">Color/Logo Match</div>
            <h3 class="value warning" id="cert-logo">0%</h3>
          </div>
          <div class="stat-card">
            <div class="label">Combined Score</div>
            <h3 class="value success" id="cert-signature">0%</h3>
          </div>
        </div>

  <!-- Sample fullscreen modal -->
  <div id="sample-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="sample-modal-title">
    <div class="modal-content" id="sample-modal-content">
      <div class="modal-header">
        <h3 id="sample-modal-title" style="margin:0;color:#566a7f;">Sample Certificate</h3>
        <div>
          <button id="btn-fullscreen" class="btn btn-outline" style="margin-right:8px;">Fullscreen</button>
          <button id="btn-close" class="btn btn-primary">Close</button>
        </div>
      </div>
      <div class="modal-body">
        <img id="sample-full" src="../assets/trial color mismatch.png" alt="Sample Full" />
      </div>
      <div class="modal-footer">
        <div class="control-row">
          <label for="range-bright">Brightness</label>
          <input id="range-bright" type="range" min="50" max="150" value="100" />
          <label for="range-contrast">Contrast</label>
          <input id="range-contrast" type="range" min="50" max="150" value="100" />
          <button id="btn-reset-controls" class="btn btn-outline" style="margin-left:auto;">Reset</button>
        </div>
      </div>
    </div>
  </div>

        <div class="details-grid">
          <div class="detail-card">
            <h5>Certificate Details</h5>
            <ul>
              <li><strong>Name:</strong> <span id="detail-name">-</span></li>
              <li><strong>Event:</strong> <span id="detail-event">-</span></li>
              <li><strong>Issuer:</strong> <span id="detail-issuer">-</span></li>
              <li><strong>Date:</strong> <span id="detail-date">-</span></li>
            </ul>
          </div>
          <div class="detail-card heatmap-container">
            <h5>Heatmap</h5>
            <img id="heatmap" src="" class="d-none" alt="Verification Heatmap">
          </div>
          <div class="detail-card">
            <h5>Final Score</h5>
            <div id="final-score-chart"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Toggle Sidebar
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('show');
    }

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', (e) => {
      const sidebar = document.getElementById('sidebar');
      const mobileBtn = document.querySelector('.mobile-menu-btn');
      if (window.innerWidth <= 1024 && 
          !sidebar.contains(e.target) && 
          !mobileBtn.contains(e.target) && 
          sidebar.classList.contains('show')) {
        sidebar.classList.remove('show');
      }
    });

    // Local history helpers
    function getLocalUploads() {
      try {
        const raw = localStorage.getItem('userCertificates');
        return raw ? JSON.parse(raw) : [];
      } catch (_) {
        return [];
      }
    }

    function setLocalUploads(items) {
      localStorage.setItem('userCertificates', JSON.stringify(items));
      try { window.dispatchEvent(new StorageEvent('storage', { key: 'userCertificates' })); } catch (_) {}
    }

    function toPercent(num) {
      return Math.round(Number(num) * 10000) / 100; // e.g., 0.9234 -> 92.34
    }

    function buildRecordFromResult(cardEl, data) {
      const imgEl = cardEl.querySelector('img');
      const src = imgEl ? imgEl.getAttribute('src') : '';
      const fileName = cardEl?.dataset?.file || 'uploaded.png';
      const combinedPct = toPercent(data?.similarities?.combined_similarity || 0);
      return {
        _id: Date.now() + '-' + Math.random().toString(16).slice(2),
        certificateId: (data?.regex_fields?.certificate_id) || ('CERT-' + Math.random().toString(36).slice(2,8).toUpperCase()),
        fileName,
        uploadDate: new Date().toISOString(),
        fields: {
          name: data?.regex_fields?.name || '-',
          event: data?.regex_fields?.event || '-',
          issuer: data?.regex_fields?.issuer || '-',
          date: data?.regex_fields?.date || new Date().toISOString().slice(0,10)
        },
        scores: {
          text: toPercent(data?.similarities?.text_similarity || 0),
          db: toPercent(data?.similarities?.db_field_score || 0),
          color: toPercent(data?.similarities?.color_similarity || 0),
          combined: Math.round(combinedPct)
        },
        previewDataUrl: src
      };
    }

    // Main functionality
    document.addEventListener("DOMContentLoaded", () => {
      const finalScoreChart = new ApexCharts(document.querySelector("#final-score-chart"), {
        chart: { 
          type: 'radialBar', 
          height: 250, 
          toolbar: { show: false } 
        },
        series: [0],
        plotOptions: {
          radialBar: {
            hollow: { size: '60%' },
            dataLabels: {
              name: { show: true },
              value: { 
                show: true, 
                fontSize: '24px', 
                formatter: val => val.toFixed(2) + "%" 
              }
            }
          }
        },
        labels: ['Combined Score'],
        colors: ['#28c76f']
      });
      finalScoreChart.render();

      const cards = document.querySelectorAll(".cert-card");
      const hero = document.getElementById("hero-section");
      const loading = document.getElementById("loading-screen");
      const dashboard = document.getElementById("dashboard");
      const heatmapImg = document.getElementById("heatmap");
      const sampleModal = document.getElementById('sample-modal');
      const sampleImage = document.getElementById('sample-image');
      const sampleFull = document.getElementById('sample-full');
      const btnClose = document.getElementById('btn-close');
      const btnFs = document.getElementById('btn-fullscreen');
      const btnReset = document.getElementById('btn-reset-controls');
      const rangeB = document.getElementById('range-bright');
      const rangeC = document.getElementById('range-contrast');

      // Custom upload: wait for user file, send to backend, then render dashboard
      const uploadCard = document.getElementById('upload-card');
      const fileInput = document.getElementById('file-input');
      if (uploadCard && fileInput) {
        uploadCard.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', async (e) => {
          const file = e.target.files && e.target.files[0];
          if (!file) return;
          hero.classList.add('d-none');
          loading.classList.remove('d-none');

          try {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('filename', file.name);
            formData.append('certificate_id', 'CERT-USER');

            const res = await fetch('/api/verify', { method: 'POST', body: formData });
            if (!res.ok) throw new Error('Verification failed');
            const data = await res.json();

            document.getElementById('cert-text').textContent = (data.similarities.text_similarity * 100).toFixed(2) + '%';
            document.getElementById('cert-meta').textContent = (data.similarities.db_field_score * 100).toFixed(2) + '%';
            document.getElementById('cert-logo').textContent = (data.similarities.color_similarity * 100).toFixed(2) + '%';
            document.getElementById('cert-signature').textContent = (data.similarities.combined_similarity * 100).toFixed(2) + '%';
            document.getElementById('detail-name').textContent = data.regex_fields.name;
            document.getElementById('detail-event').textContent = data.regex_fields.event;
            document.getElementById('detail-issuer').textContent = data.regex_fields.issuer;
            document.getElementById('detail-date').textContent = data.regex_fields.date;
            if (data.heatmap_path) { heatmapImg.src = `/api/heatmap/${data.heatmap_path}`; heatmapImg.classList.remove('d-none'); }
            finalScoreChart.updateSeries([data.similarities.combined_similarity * 100]);

            try {
              const reader = new FileReader();
              reader.onload = () => {
                let existing = [];
                try { existing = JSON.parse(localStorage.getItem('userCertificates') || '[]'); } catch(_) {}
                existing.unshift({
                  _id: Date.now() + '-' + Math.random().toString(16).slice(2),
                  certificateId: data?.regex_fields?.certificate_id || ('CERT-' + Math.random().toString(36).slice(2,8).toUpperCase()),
                  fileName: file.name,
                  uploadDate: new Date().toISOString(),
                  source: 'user',
                  fields: { name: data.regex_fields.name, issuer: data.regex_fields.issuer },
                  scores: {
                    text: Math.round(data.similarities.text_similarity * 10000) / 100,
                    db: Math.round(data.similarities.db_field_score * 10000) / 100,
                    color: Math.round(data.similarities.color_similarity * 10000) / 100,
                    combined: Math.round(data.similarities.combined_similarity * 100)
                  },
                  previewDataUrl: typeof reader.result === 'string' ? reader.result : ''
                });
                localStorage.setItem('userCertificates', JSON.stringify(existing));
                try { window.dispatchEvent(new StorageEvent('storage', { key: 'userCertificates' })); } catch(_) {}
              };
              reader.readAsDataURL(file);
            } catch(_) {}
          } catch (err) {
            console.error(err);
            alert('Verification failed. Please try again.');
          }

          loading.classList.add('d-none');
          dashboard.classList.remove('d-none');
          e.target.value = '';
        });
      }

      cards.forEach(card => {
        card.addEventListener("click", async () => {
          hero.classList.add("d-none");
          loading.classList.remove("d-none");

          const formData = new FormData();
          formData.append("filename", "trial color mismatch.png");
          formData.append("certificate_id", "CERT-SAMPLE");

          try {
          const res = await fetch("/api/verify", {
              method: "POST",
              body: formData
            });
            const data = await res.json();

            document.getElementById("cert-text").textContent = 
              (data.similarities.text_similarity * 100).toFixed(2) + "%";
            document.getElementById("cert-meta").textContent = 
              (data.similarities.db_field_score * 100).toFixed(2) + "%";
            document.getElementById("cert-logo").textContent = 
              (data.similarities.color_similarity * 100).toFixed(2) + "%";
            document.getElementById("cert-signature").textContent = 
              (data.similarities.combined_similarity * 100).toFixed(2) + "%";

            document.getElementById("detail-name").textContent = data.regex_fields.name;
            document.getElementById("detail-event").textContent = data.regex_fields.event;
            document.getElementById("detail-issuer").textContent = data.regex_fields.issuer;
            document.getElementById("detail-date").textContent = data.regex_fields.date;

            if (data.heatmap_path) {
              heatmapImg.src = `/api/heatmap/${data.heatmap_path}`;
              heatmapImg.classList.remove("d-none");
            }

            finalScoreChart.updateSeries([data.similarities.combined_similarity * 100]);

            // Save to local history (no redirect)
            try {
              const rec = buildRecordFromResult(card, data);
              const list = getLocalUploads();
              list.unshift(rec);
              setLocalUploads(list);
            } catch (_) {}

          } catch(err) {
            console.error(err);
            alert("Verification failed. Please try again.");
          }

          loading.classList.add("d-none");
          dashboard.classList.remove("d-none");
        });
      });

      // Fullscreen modal wiring
      function openModal() {
        sampleFull.src = sampleImage.currentSrc || sampleImage.src;
        sampleModal.classList.add('show');
      }
      function closeModal() { sampleModal.classList.remove('show'); }
      function applyFilter() {
        const b = Number(rangeB.value) / 100;
        const c = Number(rangeC.value) / 100;
        sampleFull.style.setProperty('--img-filter', `brightness(${b}) contrast(${c})`);
      }
      function resetControls() { rangeB.value = 100; rangeC.value = 100; applyFilter(); }

      document.getElementById('sample-card').addEventListener('dblclick', openModal);
      btnClose?.addEventListener('click', closeModal);
      btnFs?.addEventListener('click', async () => {
        const el = document.getElementById('sample-modal-content');
        try {
          if (document.fullscreenElement) await document.exitFullscreen();
          else await el.requestFullscreen();
        } catch(_) {}
      });
      rangeB?.addEventListener('input', applyFilter);
      rangeC?.addEventListener('input', applyFilter);
      btnReset?.addEventListener('click', resetControls);
      sampleModal.addEventListener('click', (e) => { if (e.target === sampleModal) closeModal(); });
      resetControls();
    });
  </script>
</body>
</html>