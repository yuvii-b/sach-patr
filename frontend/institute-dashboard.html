<!DOCTYPE html>
<html lang="en" class="light-style layout-menu-fixed" dir="ltr" data-theme="theme-default" data-assets-path="../assets/" data-template="vertical-menu-template-free">
<head>
  <meta charset="utf-8" />
  <title>Institute Dashboard | Fake Degree Recognition System</title>
  <link rel="stylesheet" href="../assets/vendor/css/core.css" />
  <link rel="stylesheet" href="../assets/vendor/css/theme-default.css" />
  <link rel="stylesheet" href="../assets/css/demo.css" />
  <link rel="stylesheet" href="../assets/vendor/fonts/boxicons.css" />
  <script src="../assets/vendor/js/helpers.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@700&family=Playfair+Display:wght@700&family=Yeseva+One&display=swap" rel="stylesheet">
  <style>
    .logo-text { font-family: 'UnifrakturCook', 'Playfair Display', 'Yeseva One', serif; font-weight:700; letter-spacing:1px; text-transform:none; font-size:28px; color:#0f172a; line-height:1; white-space:nowrap; }
  </style>
  <script src="../assets/js/config.js"></script>
</head>
<body>
  <div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
      <!-- Sidebar -->
      <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
        <div class="app-brand demo">
          <a href="institute-dashboard.html" class="app-brand-link">
            <span class="logo-text">Sachpatr</span>
          </a>
          <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto d-block d-xl-none">
            <i class="bx bx-chevron-left bx-sm align-middle"></i>
          </a>
        </div>
        <div class="menu-inner-shadow"></div>
        <ul class="menu-inner py-1">
          <li class="menu-item active">
            <a href="institute-dashboard.html" class="menu-link">
              <i class="menu-icon tf-icons bx bx-home-circle"></i>
              <div data-i18n="Dashboard">Dashboard</div>
            </a>
          </li>
          <li class="menu-item">
            <a href="upload-certificates.html" class="menu-link">
              <i class="menu-icon tf-icons bx bx-upload"></i>
              <div data-i18n="Upload">Upload Certificates</div>
            </a>
          </li>
          <li class="menu-item">
            <a href="institute-alerts.html" class="menu-link">
              <i class="menu-icon tf-icons bx bx-bell"></i>
              <div data-i18n="Alerts">Alerts</div>
            </a>
          </li>
        </ul>
      </aside>
      <!-- / Sidebar -->

      <div class="layout-page">
        <!-- Navbar -->
        <nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme" id="layout-navbar">
          <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
            <ul class="navbar-nav flex-row align-items-center ms-auto">
              <li class="nav-item navbar-dropdown dropdown-user dropdown">
                <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown">
                  <div class="avatar avatar-online">
                    <img src="../assets/img/avatars/1.png" alt class="w-px-40 h-auto rounded-circle"/>
                  </div>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li><a class="dropdown-item" href="institute-profile.html"><i class="bx bx-user me-2"></i> My Profile</a></li>
                  <li><a class="dropdown-item" href="auth-login-basic.html"><i class="bx bx-power-off me-2"></i> Log Out</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </nav>
        <!-- / Navbar -->

        <div class="content-wrapper container-xxl flex-grow-1 container-p-y">
          <h4 class="py-2">Institute Dashboard</h4>
          <div class="row g-3">
            <!-- Cards -->
            <div class="col-md-6 col-lg-3">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Total Certificates</h5>
                  <p class="card-text fs-3 fw-bold" id="stat-total">0</p>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-lg-3">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Flagged</h5>
                  <p class="card-text fs-3 fw-bold" id="stat-flagged">0</p>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-lg-3">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Verified</h5>
                  <p class="card-text fs-3 fw-bold" id="stat-verified">0</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Uploads Table -->
          <div class="card mt-4">
            <h5 class="card-header">Recent Uploads</h5>
            <div class="card-body">
              <table class="table">
                <thead>
                  <tr>
                    <th>Certificate ID</th>
                    <th>Student</th>
                    <th>Institution</th>
                    <th>Date</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody id="recent-uploads-body">
                </tbody>
              </table>
            </div>
          </div>

        </div>

        <footer class="content-footer footer bg-footer-theme">
          <div class="container-xxl d-flex justify-content-between py-2">
            Â© <script>document.write(new Date().getFullYear());</script>, Government of Jharkhand
          </div>
        </footer>

      </div>
    </div>
  </div>

  <script src="../assets/vendor/js/bootstrap.js"></script>
  <script src="../assets/vendor/js/menu.js"></script>
  <script>
    function getLocalUploads() {
      try {
        const raw = localStorage.getItem('userCertificates');
        return raw ? JSON.parse(raw) : [];
      } catch (_) { return []; }
    }

    function formatDate(iso) {
      if (!iso) return '-';
      try { const d = new Date(iso); return d.toLocaleDateString('en-GB', { day:'2-digit', month:'short', year:'numeric' }); } catch(_) { return iso; }
    }

    function computeStats(list) {
      const total = list.length;
      let verified = 0, flagged = 0;
      list.forEach(it => {
        const combined = typeof it.scores?.combined === 'number' ? it.scores.combined : 0;
        if (combined >= 80) verified++; else if (combined < 60) flagged++;
      });
      return { total, verified, flagged };
    }

    function renderInstitute() {
      const list = getLocalUploads();
      const stats = computeStats(list);
      const $t = document.getElementById('stat-total');
      const $v = document.getElementById('stat-verified');
      const $f = document.getElementById('stat-flagged');
      if ($t) $t.textContent = String(stats.total);
      if ($v) $v.textContent = String(stats.verified);
      if ($f) $f.textContent = String(stats.flagged);

      const body = document.getElementById('recent-uploads-body');
      if (!body) return;
      body.innerHTML = '';
      const rows = list.slice(0, 10).map(item => {
        const state = (typeof item.scores?.combined === 'number' && item.scores.combined >= 80) ? 'Verified' : (item.scores?.combined < 60 ? 'Flagged' : 'Review');
        const badge = state === 'Verified' ? 'bg-success' : state === 'Flagged' ? 'bg-danger' : 'bg-warning';
        return `<tr>
          <td>${item.certificateId || '-'}</td>
          <td>${item.fields?.name || 'N/A'}</td>
          <td>${item.fields?.issuer || 'N/A'}</td>
          <td>${formatDate(item.uploadDate)}</td>
          <td><span class="badge ${badge}">${state}</span></td>
        </tr>`;
      }).join('');
      body.innerHTML = rows || '<tr><td colspan="5" class="text-center text-muted">No uploads yet</td></tr>';
    }

    document.addEventListener('DOMContentLoaded', () => {
      renderInstitute();
      window.addEventListener('storage', (e) => { if (!e || e.key === null || e.key === 'userCertificates') renderInstitute(); });
      window.addEventListener('focus', renderInstitute);
      document.addEventListener('visibilitychange', () => { if (document.visibilityState === 'visible') renderInstitute(); });
      setInterval(renderInstitute, 2000);
    });
  </script>
</body>
</html>
